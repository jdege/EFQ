<!-- formatted code using http://ajblk.github.io/SyntaxHighlightGenerator-v3.0/OnlineGenerator.html
Language: C#
Theme: Default
Show Gutter: No
Show Toolbar: No
Collapse All: No
Blogger Mode: No
Start Line number:
Line no. padding:
Hightlight Line no.:
Title Above Code:
-->

<script type="text/javascript" src="http://ajblk.github.io/SyntaxHighlightGenerator-v3.0/scripts/sh-v3.0-min.js"></script>
<link type="text/css" rel="stylesheet" href="http://ajblk.github.io/SyntaxHighlightGenerator-v3.0/styles/shCoreDefault.css" />

<p>
	This demo differs from the <a href="EFQueryOnServer">previous</a> in that we're attaching an EFQuery object
	to each element in the select lists.
</p>

<div id="highlighterMainDiv_735387" class="syntaxhighlighter nogutter csharp"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td>&nbsp;</td></tr><tr><td id="codeContainer_735387" class="code"><div id="container_735387" class="container"><div class="line number1 index0 alt2"><code class="csharp keyword">private</code> <code class="csharp plain">IEnumerable&lt;SelectionListDTO&gt; getClientQueries()</code></div><div class="line number2 index1 alt1"><code class="csharp plain">{</code></div><div class="line number3 index2 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">var other = </code><code class="csharp keyword">this</code><code class="csharp plain">.getClientSelectionList();</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">var query = EFQuery.equal(</code><code class="csharp string">"CustomerId"</code><code class="csharp plain">, </code><code class="csharp string">"WECUTGRASS"</code><code class="csharp plain">);</code></div><div class="line number6 index5 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">var predicate = query.constructPredicate&lt;Client&gt;();</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">using</code> <code class="csharp plain">(var dbContext = </code><code class="csharp keyword">new</code> <code class="csharp plain">EFQueryDemoDatabaseContext())</code></div><div class="line number9 index8 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">{</code></div><div class="line number10 index9 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">var clients = dbContext.Clients</code></div><div class="line number11 index10 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">.Where(predicate)</code></div><div class="line number12 index11 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">.OrderBy(c =&gt; c.Name)</code></div><div class="line number13 index12 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">.ToList() </code><code class="csharp comments">// execute query in DB</code></div><div class="line number14 index13 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">.Select(c =&gt; </code><code class="csharp keyword">new</code> <code class="csharp plain">SelectionListDTO</code></div><div class="line number15 index14 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">{</code></div><div class="line number16 index15 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">value = c.ClientId,</code></div><div class="line number17 index16 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">text = c.Name,</code></div><div class="line number18 index17 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">query = EFQuery.equal(</code><code class="csharp string">"ClientId"</code><code class="csharp plain">, c.ClientId)</code></div><div class="line number19 index18 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">});</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">return</code> <code class="csharp plain">clients;</code></div><div class="line number22 index21 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number23 index22 alt2"><code class="csharp plain">}</code></div></div></td></tr><tr><td>&nbsp;</td></tr><tr><td>&nbsp;</td></tr></tbody></table></div>

<pre id="presourcecode_735387" class="displaysourcecode">
private IEnumerable&lt;SelectionListDTO&gt; getClientQueries()
{
    var other = this.getClientSelectionList();
    var query = EFQuery.equal("CustomerId", "WECUTGRASS");
    var predicate = query.constructPredicate&lt;Client&gt;();
    using (var dbContext = new EFQueryDemoDatabaseContext())
    {
        var clients = dbContext.Clients
            .Where(predicate)
            .OrderBy(c =&gt; c.Name)
            .ToList() // execute query in DB
            .Select(c =&gt; new SelectionListDTO
            {
                value = c.ClientId,
                text = c.Name,
                query = EFQuery.equal("ClientId", c.ClientId)
            });
        return clients;
    }
}
</pre>

<p>
	When we use these to populate the select element on the client, we store each query object as a
	data attribute of the element.
</p>

<div id="highlighterMainDiv_638335" class="syntaxhighlighter nogutter jscript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td>&nbsp;</td></tr><tr><td id="codeContainer_638335" class="code"><div id="container_638335" class="container"><div class="line number1 index0 alt2"><code class="jscript keyword">var</code> <code class="jscript plain">fillSelect = </code><code class="jscript keyword">function</code><code class="jscript plain">($select, result) {</code></div><div class="line number2 index1 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">if</code> <code class="jscript plain">(result.success) {</code></div><div class="line number3 index2 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$select.empty();</code></div><div class="line number4 index3 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$select.append(</code><code class="jscript string">"&lt;option /&gt;"</code><code class="jscript plain">);</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$.each(result.data, </code><code class="jscript keyword">function</code><code class="jscript plain">(index, item) {</code></div><div class="line number7 index6 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$select.append($(</code><code class="jscript string">"&lt;option /&gt;"</code><code class="jscript plain">).val(item.value || index).text(item.text).data(</code><code class="jscript string">'query'</code><code class="jscript plain">, item.query));</code></div><div class="line number8 index7 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number9 index8 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">} </code><code class="jscript keyword">else</code> <code class="jscript plain">{</code></div><div class="line number10 index9 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">alert(result.error);</code></div><div class="line number11 index10 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number12 index11 alt1"><code class="jscript plain">};</code></div></div></td></tr><tr><td>&nbsp;</td></tr><tr><td>&nbsp;</td></tr></tbody></table></div>

<pre id="presourcecode_638335" class="displaysourcecode">
var fillSelect = function($select, result) {
    if (result.success) {
        $select.empty();
        $select.append("&lt;option /&gt;");
        $.each(result.data, function(index, item) {
            $select.append($("&lt;option /&gt;").val(item.value || index).text(item.text).data('query', item.query));
        });
    } else {
        alert(result.error);
    }
};
</pre>

<p>
	When the user clicks "Search" we ignore the selected value, and instead use the associated
	EFQuery object, which we then use to construct a new EFQuery object which we hand off to
	the server to be run against the database:
</p>

<div id="highlighterMainDiv_494728" class="syntaxhighlighter nogutter jscript"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td>&nbsp;</td></tr><tr><td id="codeContainer_494728" class="code"><div id="container_494728" class="container"><div class="line number1 index0 alt2"><code class="jscript plain">$(</code><code class="jscript string">"#Submit"</code><code class="jscript plain">).click(</code><code class="jscript keyword">function</code><code class="jscript plain">() {</code></div><div class="line number2 index1 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">andQueries = [EFQuery.isTrue()];</code></div><div class="line number3 index2 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">clientQuery = $clientSelect.find(</code><code class="jscript string">':selected'</code><code class="jscript plain">).data(</code><code class="jscript string">'query'</code><code class="jscript plain">);</code></div><div class="line number4 index3 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">if</code> <code class="jscript plain">(clientQuery)</code></div><div class="line number5 index4 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">andQueries.push(clientQuery);</code></div><div class="line number6 index5 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">workerQuery = $workerSelect.find(</code><code class="jscript string">':selected'</code><code class="jscript plain">).data(</code><code class="jscript string">'query'</code><code class="jscript plain">);</code></div><div class="line number7 index6 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">if</code> <code class="jscript plain">(workerQuery)</code></div><div class="line number8 index7 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">andQueries.push(workerQuery);</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">query = EFQuery.and(andQueries);</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">TaskQueryService.getTasks2(query, </code><code class="jscript keyword">function</code><code class="jscript plain">(result) {</code></div><div class="line number13 index12 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">if</code> <code class="jscript plain">(result.success) {</code></div><div class="line number14 index13 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">data = result.data;</code></div><div class="line number15 index14 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$tasksTable.clear();</code></div><div class="line number16 index15 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$tasksTable.rows.add(data);</code></div><div class="line number17 index16 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">$tasksTable.draw();</code></div><div class="line number18 index17 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">} </code><code class="jscript keyword">else</code> <code class="jscript plain">{</code></div><div class="line number19 index18 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">alert(result.error);</code></div><div class="line number20 index19 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number21 index20 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">});</code></div><div class="line number22 index21 alt1"><code class="jscript plain">});</code></div></div></td></tr><tr><td>&nbsp;</td></tr><tr><td>&nbsp;</td></tr></tbody></table></div>

<pre id="presourcecode_494728" class="displaysourcecode">
$("#Submit").click(function() {
    var andQueries = [EFQuery.isTrue()];
    var clientQuery = $clientSelect.find(':selected').data('query');
    if (clientQuery)
        andQueries.push(clientQuery);
    var workerQuery = $workerSelect.find(':selected').data('query');
    if (workerQuery)
        andQueries.push(workerQuery);
    var query = EFQuery.and(andQueries);
    TaskQueryService.getTasks2(query, function(result) {
        if (result.success) {
            var data = result.data;
            $tasksTable.clear();
            $tasksTable.rows.add(data);
            $tasksTable.draw();
        } else {
            alert(result.error);
        }
    });
});
</pre>

<p>
	On the server, we simply run the query as-is, after restricting it to the correct customer.
</p>

<div id="highlighterMainDiv_840561" class="syntaxhighlighter nogutter csharp"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td>&nbsp;</td></tr><tr><td id="codeContainer_840561" class="code"><div id="container_840561" class="container"><div class="line number1 index0 alt2"><code class="csharp plain">[HttpPost]</code></div><div class="line number2 index1 alt1"><code class="csharp plain">[Route(</code><code class="csharp string">"api/Tasks2"</code><code class="csharp plain">)]</code></div><div class="line number3 index2 alt2"><code class="csharp keyword">public</code> <code class="csharp plain">ActionResult getTasks2(EFQuery efQuery)</code></div><div class="line number4 index3 alt1"><code class="csharp plain">{</code></div><div class="line number5 index4 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">var query = EFQuery.and(efQuery, EFQuery.equal(</code><code class="csharp string">"CustomerId"</code><code class="csharp plain">, </code><code class="csharp string">"WECUTGRASS"</code><code class="csharp plain">));</code></div><div class="line number6 index5 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">var predicate = query.constructPredicate&lt;Task&gt;();</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">var rows = </code><code class="csharp keyword">new</code> <code class="csharp plain">List&lt;TaskModel&gt;();</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">using</code> <code class="csharp plain">(var dbContext = </code><code class="csharp keyword">new</code> <code class="csharp plain">EFQueryDemoDatabaseContext())</code></div><div class="line number11 index10 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">{</code></div><div class="line number12 index11 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">var tasks = dbContext.Tasks.Where(predicate);</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">foreach</code> <code class="csharp plain">(var task </code><code class="csharp keyword">in</code> <code class="csharp plain">tasks)</code></div><div class="line number15 index14 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">{</code></div><div class="line number16 index15 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">var taskModel = </code><code class="csharp keyword">new</code> <code class="csharp plain">TaskModel</code></div><div class="line number17 index16 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">{</code></div><div class="line number18 index17 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">ClientName = task.Client.Name,</code></div><div class="line number19 index18 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">Status = task.Status,</code></div><div class="line number20 index19 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">WorkToBeDone = task.WorkToBeDone,</code></div><div class="line number21 index20 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">Address1 = task.Address1,</code></div><div class="line number22 index21 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">Address2 = task.Address2,</code></div><div class="line number23 index22 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">City = task.City,</code></div><div class="line number24 index23 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">State = task.State,</code></div><div class="line number25 index24 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">Zipcode = task.Zipcode</code></div><div class="line number26 index25 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">};</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">rows.Add(taskModel);</code></div><div class="line number29 index28 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number30 index29 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number31 index30 alt2">&nbsp;</div><div class="line number32 index31 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">return</code> <code class="csharp plain">Json(rows);</code></div><div class="line number33 index32 alt2"><code class="csharp plain">}</code></div></div></td></tr><tr><td>&nbsp;</td></tr><tr><td>&nbsp;</td></tr></tbody></table></div>

<pre id="presourcecode_840561" class="displaysourcecode">
[HttpPost]
[Route("api/Tasks2")]
public ActionResult getTasks2(EFQuery efQuery)
{
    var query = EFQuery.and(efQuery, EFQuery.equal("CustomerId", "WECUTGRASS"));
    var predicate = query.constructPredicate&lt;Task&gt;();
    var rows = new List&lt;TaskModel&gt;();
    using (var dbContext = new EFQueryDemoDatabaseContext())
    {
        var tasks = dbContext.Tasks.Where(predicate);
        foreach (var task in tasks)
        {
            var taskModel = new TaskModel
            {
                ClientName = task.Client.Name,
                Status = task.Status,
                WorkToBeDone = task.WorkToBeDone,
                Address1 = task.Address1,
                Address2 = task.Address2,
                City = task.City,
                State = task.State,
                Zipcode = task.Zipcode
            };
            rows.Add(taskModel);
        }
    }
    return Json(rows);
}
</pre>

<script type="text/javascript">SyntaxHighlighter.initialize();</script>


